{
  "schema": 1,
  "name": "Entropia Flow Hunting",
  "author": "Lucho MUCHO Ireton",
  "lastModified": 1752950194595,
  "backgroundType": 7,
  "formulaJavaScript": "function before(t) { return t.history.filter(x => x.time <= inventoryTime).map(x => x.value) }\nfunction after(t) { return t.history.filter(x => x.time > inventoryTime).map(x => x.value) }\nfunction sum(l) { return l.length === 0 ? 0 : l.reduce((a,b) => a+b) }\nfunction count(l) { return l.length }\nfunction average(l) { return sum(l) / count(l) }\n\nfunction lastSeconds(t, seconds) { // get the sum per each second\n  let last = 0;\n  let from = new Date().getTime() - 1000;\n  const list = [];\n  for (const v of t.history) {\n    while (v.time <= from && seconds > 0) {\n      list.push(last);\n      last = 0;\n      from -= 1000;\n      seconds--;\n    }\n    if (seconds === 0) break;\n    last += v.value;\n  }\n  if (seconds > 0) {\n    list.push(last);\n  }\n  while (seconds > 1) {\n    list.push(0);\n    seconds--;\n  }\n  return list\n}\n\nconst beforeDmg     = sum(before(damageInflicted)) // Inflicted damage before checkpoint\nconst beforeMiss    = count(before(targetDodgedAttack)) + count(before(targetEvadedAttack)); // Missed attacks before checkpoint\nconst beforeAttacks = beforeMiss + count(before(damageInflicted)); // Total attacks before checkpoint\nconst beforeLoot    = sum(before(lootStats))\nconst beforeDecay   = beforeLoot - delta\n\nconst baseDPP  = 2.8\nconst missCost = beforeAttacks === 0 ? 0 : beforeDecay / beforeAttacks; // Estimated cost per missed attack\nconst dmgCost  = beforeDmg === 0 ? 0.01 / baseDPP : (beforeDecay - missCost * beforeMiss) / beforeDmg; // Estimated cost per inflicted damage\n\nconst afterMiss  = count(after(targetDodgedAttack)) + count(after(targetEvadedAttack)); // Missed attacks after checkpoint\nconst afterDmg   = sum(after(damageInflicted)); // Inflicted damage after checkpoint\nconst afterDecay = afterMiss * missCost + afterDmg * dmgCost; // Cost after checkpoint\nconst afterLoot  = sum(after(lootStats)); // Loot obtained after checkpoint\n\nconst lastDmg = lastSeconds(damageInflicted, 10).filter(x => x > 0);\n\nconst dmg   = beforeDmg + afterDmg;\nconst decay = beforeDecay + afterDecay;\nconst loot_ = sum(loot.map(x => x.value));\n\nconst dpp      = (dmg === 0 || decay === 0 ? baseDPP : dmg / (decay*100)).toFixed(2); // Damage per PEC\nconst dps      = (lastDmg.length === 0 ? 0 : average(lastDmg)).toFixed(1); // Damage per second\nconst return_  = decay === 0 ? '' : (loot_ / decay * 100).toFixed(2) + '%';\n\nconst deltaNow_ = delta - afterDecay + afterLoot\nconst deltaNow  = deltaNow_.toFixed(2);\nconst deltaNowBackColor = deltaNow_ > 0 ? 'green'  : (deltaNow_ < 0 ? 'red'  : 'black');\n\nconst showLast = delta !== '0.00'\n\nlet lastKillDecay = ''\nlet lastKillLoot = ''\n\nconst lastKillTime = kills.history.length > 0 ? kills.history[0].time : 0;\nfunction curr(t) { return t.history.filter(x => x.time > lastKillTime).map(x => x.value) }\nconst currKillMiss  = count(curr(targetDodgedAttack)) + count(curr(targetEvadedAttack));\nconst currKillDmg   = sum(curr(damageInflicted));\nif (currKillMiss > 0 || currKillDmg > 0) {\n  const currDecay = currKillMiss * missCost + currKillDmg * dmgCost; // Cost of current kill\n  lastKillDecay = currDecay.toFixed(2)\n} else if (lastKillTime > 0) { \n  const prevKillTime = kills.history.length > 1 ? kills.history[1].time : 0;\n  function on(t) { return t.history.filter(x => x.time <= lastKillTime && x.time > prevKillTime).map(x => x.value) }\n  \n  const lastKillLoot_  = sum(on(lootStats));\n  const lastKillMiss   = count(on(targetDodgedAttack)) + count(on(targetEvadedAttack));\n  const lastKillDmg    = sum(on(damageInflicted));\n  const lastKillDecay_ = lastKillMiss * missCost + lastKillDmg * dmgCost; // Cost of last kill\n\n  lastKillDecay = lastKillDecay_.toFixed(2);\n  lastKillLoot = lastKillLoot_.toFixed(2);\n}",
  "htmlTemplate": "<div class='root'>\n  <div class='header'>\n    <img class='logo' src='{{logoUrl}}' alt='Logo'></img>\n    <div class='column'>\n      <div class='delta'>\n        <b>{{deltaNow}} PED</b>\n        {{#showLast}}<img class='setlast' src='{{img.tick}}' data-click='flowSetLast'>{{/showLast}}\n      </div>\n      <div class='message'>{{message}}</div>\n    </div>\n    {{#return_}}<div class='return'>return <b>{{return_}}</b></div>{{/return_}}\n  </div>\n  <div class='stats'>\n    <div>dpp <b>{{dpp}}</b></div>\n    <div>dps <b>{{dps}}</b></div>\n    <div>kills <b>{{kills.total}}</b></div>\n    {{#lastKillDecay}}\n      <div class='last'>\n        {{#lastKillLoot}}<b class='lastloot'>+{{lastKillLoot}}</b>{{/lastKillLoot}}\n        {{^lastKillLoot}}last{{/lastKillLoot}}\n        <b {{#lastKillLoot}}class='lastdecay'{{/lastKillLoot}}>-{{lastKillDecay}}</b>\n      </div>\n    {{/lastKillDecay}}\n  </div>\n</div>",
  "cssTemplate": ".root {\n  margin: 5px;\n  min-width: 250px;\n}\n.header {\n  display: flex;\n  align-items: start;\n  justify-content: space-between;\n}\n.logo { width: 40px; align-self: start; margin-left: 5px; margin-top: 5px; }\n.column { display: flex; flex-direction: column; margin: 0px 8px; flex: 1; }\n.message { font-size: 10px; text-align: center; width: 100%; }\n.delta {\n  display: flex;\n  background-color: {{deltaNowBackColor}};\n  color: white;\n  font-size: 18px;\n  padding: 8px;\n  border-radius: 8px;\n  text-align: center;\n  flex: 1;\n}\n.delta b {\n  flex: 1;\n}\n.setlast {\n  height: 12px;\n  align-self: center;\n  cursor: pointer;\n  margin-left: 2px;\n}\n.stats {\n  display: flex;\n  margin: 3px 0px;\n  gap: 5px;\n  justify-content: space-between;\n}\n.stats > div, .return {\n  font-family: sans-serif;\n  text-align: center;\n  font-size: 10px;\n  border-radius: 8px;\n  padding: 7px 10px;\n  background: rgba(0,0,0,.3);\n}\n.stats > div {\n  flex: 1;\n}\n.stats > div b, .return b {\n  display: block;\n  font-size: 15px;\n}\n.last {\n  position: relative;\n}\n.lastloot {\n  position: absolute;\n  top: 4px;\n  right: 8px;\n}\n.lastdecay {\n  position: absolute;\n  top: 21px;\n  right: 8px;\n}",
  "images": [
    {
      "name": "tick",
      "value": "data:image/png;base64,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"
    }
  ]
}